{"version":3,"file":"js/comic.2f3f8b15.js","mappings":"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","sources":["webpack://silverfish/./src/views/book/VComic.vue?6c4c","webpack://silverfish/./src/views/book/VComic.vue?389c","webpack://silverfish/./src/views/book/VComic.vue"],"sourcesContent":["import { resolveComponent as _resolveComponent, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, resolveDirective as _resolveDirective, createElementVNode as _createElementVNode, withDirectives as _withDirectives, withCtx as _withCtx, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-02ac775b\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = {\n  id: \"article\",\n  class: \"container\"\n}\nconst _hoisted_2 = {\n  key: 0,\n  class: \"row\"\n}\nconst _hoisted_3 = { class: \"col-12\" }\nconst _hoisted_4 = { id: \"comic\" }\nconst _hoisted_5 = [\"src\", \"alt\"]\nconst _hoisted_6 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"br\", null, null, -1))\nconst _hoisted_7 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"br\", null, null, -1))\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_reader_nav = _resolveComponent(\"reader-nav\")!\n  const _component_loading = _resolveComponent(\"loading\")!\n  const _component_center = _resolveComponent(\"center\")!\n  const _directive_observe_visibility = _resolveDirective(\"observe-visibility\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", {\n    id: \"content\",\n    style: _normalizeStyle({ 'min-height': `${_ctx.height}px` })\n  }, [\n    _createElementVNode(\"div\", _hoisted_1, [\n      (Object.keys(_ctx.comic).length !== 0)\n        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n            _createVNode(_component_reader_nav, {\n              type: 'comic',\n              id: _ctx.comicID,\n              currentIndex: _ctx.currentIndex,\n              onChangeIndex: _ctx.onChangeIndex,\n              chapterLength: _ctx.comic.chapters.length\n            }, null, 8, [\"id\", \"currentIndex\", \"onChangeIndex\", \"chapterLength\"]),\n            _createElementVNode(\"div\", _hoisted_3, [\n              _createElementVNode(\"div\", _hoisted_4, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.sections, (each) => {\n                  return (_openBlock(), _createElementBlock(\"div\", {\n                    key: each.index\n                  }, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(each.content, (every) => {\n                      return (_openBlock(), _createElementBlock(\"img\", {\n                        key: every,\n                        referrerpolicy: \"no-referrer\",\n                        style: _normalizeStyle(_ctx.getStyle(every)),\n                        src: every,\n                        alt: each.index.toString()\n                      }, null, 12, _hoisted_5))\n                    }), 128)),\n                    _withDirectives(_createElementVNode(\"hr\", null, null, 512), [\n                      [_directive_observe_visibility, {\n                callback: (isVisible, entry) => _ctx.observe(isVisible, entry, each)}\n              ]\n                    ])\n                  ]))\n                }), 128))\n              ]),\n              _createElementVNode(\"div\", null, [\n                _hoisted_6,\n                _hoisted_7,\n                _createVNode(_component_center, null, {\n                  default: _withCtx(() => [\n                    _createVNode(_component_loading, { size: 150 })\n                  ]),\n                  _: 1\n                })\n              ])\n            ])\n          ]))\n        : _createCommentVNode(\"\", true)\n    ])\n  ], 4))\n}","\nimport {\n  defineComponent, ref, reactive, inject, computed, ComputedRef,\n} from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useStore } from '@/store';\n\nimport fetchAPI from '@/api/fetch';\nimport { Chapter } from '@/api/type';\n\nimport ReaderNav from '@/components/reader/CReaderNav.vue';\n\nexport default defineComponent({\n  components: { ReaderNav },\n  setup() {\n    const route = useRoute();\n    const store = useStore();\n    const { fetchComicByID, fetchComicChapter } = fetchAPI();\n    const height = inject('height');\n    const session = inject<ComputedRef<string>>('session')!;\n    const comicID = ref('');\n    const lightOn = ref(false);\n    const loading = ref(false);\n    const sections = reactive<Array<Chapter>>([]);\n    const fetchIndex = ref(0);\n    const currentIndex = ref(1);\n    const transitIndex = ref(0);\n    const bookmark = computed(() => store.getters['user/getComicBookmarkByID'](comicID.value) || {});\n    const comic = computed(() => store.getters['book/getComicByID'](comicID.value) || {});\n\n    const fetchChapter = async (index: number): Promise<Chapter> => {\n      const data = await fetchComicChapter(session.value, comicID.value, index);\n      return {\n        index,\n        content: data,\n      };\n    };\n    const get = async () => {\n      sections.splice(0);\n      fetchIndex.value = currentIndex.value - 1;\n      transitIndex.value = currentIndex.value - 1;\n\n      await fetchChapter(fetchIndex.value).then((data) => sections.push(data));\n      fetchIndex.value += 1;\n      await fetchChapter(fetchIndex.value).then((data) => sections.push(data));\n      fetchIndex.value += 1;\n    };\n    const created = async () => {\n      comicID.value = route.params.comicID as string;\n\n      if (!store.getters['book/isComicIDExists'](comicID.value)) {\n        await fetchComicByID(session.value, comicID.value)\n          .then((data) => store.commit('book/insertComic', { comicID: comicID.value, comic: data }));\n      } else {\n        const localComic = store.getters['book/getComicByID'](comicID.value);\n        if (localComic.chapters === undefined\n          || store.getters['book/isComicNeedUpdate'](comicID.value)) {\n          await fetchComicByID(session.value, comicID.value)\n            .then((data) => store.commit('book/updateComic', { comicID: comicID.value, comic: data }));\n        }\n        currentIndex.value = bookmark.value.lastReadIndex || currentIndex.value;\n      }\n      get();\n    };\n    const onChangeIndex = (setIndex: number) => {\n      currentIndex.value = setIndex;\n      get();\n    };\n    const getStyle = (url: string) => (url.endsWith('20%') ? { width: '20%' } : {});\n    const observe = (isVisible: boolean, entry: any, section: Chapter) => {\n      if (isVisible) {\n        if (transitIndex.value < section.index) {\n          currentIndex.value = section.index + 1;\n          transitIndex.value = section.index;\n          bookmark.value.lastReadIndex = currentIndex.value;\n          store.commit('user/insertComicBookmark', { comicID: comic.value.comicID, bookmark: bookmark.value });\n          if (!loading.value && fetchIndex.value - currentIndex.value < 1) {\n            loading.value = true;\n            fetchChapter(fetchIndex.value).then((data) => sections.push(data));\n            fetchIndex.value += 1;\n            setTimeout(() => {\n              loading.value = false;\n            }, 1000);\n          }\n        }\n      }\n    };\n\n    created();\n\n    /* eslint-disable object-property-newline */\n    return {\n      height, comicID, loading, lightOn,\n      sections, fetchIndex, currentIndex, transitIndex,\n      bookmark, comic,\n      onChangeIndex, getStyle, observe,\n    };\n    /* eslint-enable object-property-newline */\n  },\n});\n","import { render } from \"./VComic.vue?vue&type=template&id=02ac775b&scoped=true&ts=true\"\nimport script from \"./VComic.vue?vue&type=script&lang=ts\"\nexport * from \"./VComic.vue?vue&type=script&lang=ts\"\n\nimport \"./VComic.vue?vue&type=style&index=0&id=02ac775b&scoped=true&lang=css\"\n\nimport exportComponent from \"/home/runner/work/Silverfish-Vue/Silverfish-Vue/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-02ac775b\"]])\n\nexport default __exports__"],"names":["_withScopeId","n","_pushScopeId","_popScopeId","_hoisted_1","id","class","_hoisted_2","key","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_createElementVNode","_hoisted_7","render","_ctx","_cache","$props","$setup","$data","$options","_component_reader_nav","_resolveComponent","_component_loading","_component_center","_directive_observe_visibility","_resolveDirective","_openBlock","_createElementBlock","style","_normalizeStyle","height","Object","keys","comic","length","_createVNode","type","comicID","currentIndex","onChangeIndex","chapterLength","chapters","_Fragment","_renderList","sections","each","index","content","every","referrerpolicy","getStyle","src","alt","toString","_withDirectives","callback","isVisible","entry","observe","default","_withCtx","size","_","_createCommentVNode","defineComponent","components","ReaderNav","setup","route","useRoute","store","useStore","fetchComicByID","fetchComicChapter","fetchAPI","inject","session","ref","lightOn","loading","reactive","fetchIndex","transitIndex","bookmark","computed","getters","value","fetchChapter","async","data","get","splice","then","push","created","params","localComic","undefined","commit","lastReadIndex","setIndex","url","endsWith","width","section","setTimeout","__exports__"],"sourceRoot":""}