{"version":3,"file":"js/comic.43af30bf.js","mappings":"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","sources":["webpack://silverfish/./src/views/book/VComic.vue?d144","webpack://silverfish/./src/views/book/VComic.vue?389c","webpack://silverfish/./src/views/book/VComic.vue"],"sourcesContent":["import { resolveComponent as _resolveComponent, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, resolveDirective as _resolveDirective, createElementVNode as _createElementVNode, withDirectives as _withDirectives, withCtx as _withCtx, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-1f0dd363\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = {\n  id: \"article\",\n  class: \"container\"\n}\nconst _hoisted_2 = {\n  key: 0,\n  class: \"row\"\n}\nconst _hoisted_3 = { class: \"col-12\" }\nconst _hoisted_4 = { id: \"comic\" }\nconst _hoisted_5 = [\"src\", \"alt\"]\nconst _hoisted_6 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"br\", null, null, -1))\nconst _hoisted_7 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"br\", null, null, -1))\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_reader_nav = _resolveComponent(\"reader-nav\")!\n  const _component_loading = _resolveComponent(\"loading\")!\n  const _component_center = _resolveComponent(\"center\")!\n  const _directive_observe_visibility = _resolveDirective(\"observe-visibility\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", {\n    id: \"content\",\n    style: _normalizeStyle({ 'min-height': `${_ctx.height}px` })\n  }, [\n    _createElementVNode(\"div\", _hoisted_1, [\n      (Object.keys(_ctx.comic).length !== 0)\n        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n            _createVNode(_component_reader_nav, {\n              type: 'comic',\n              id: _ctx.comicID,\n              currentIndex: _ctx.currentIndex,\n              onChangeIndex: _ctx.onChangeIndex,\n              chapterLength: _ctx.comic.chapters.length\n            }, null, 8, [\"id\", \"currentIndex\", \"onChangeIndex\", \"chapterLength\"]),\n            _createElementVNode(\"div\", _hoisted_3, [\n              _createElementVNode(\"div\", _hoisted_4, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.sections, (each) => {\n                  return (_openBlock(), _createElementBlock(\"div\", {\n                    key: each.index\n                  }, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(each.content, (every) => {\n                      return (_openBlock(), _createElementBlock(\"img\", {\n                        key: every,\n                        referrerpolicy: \"no-referrer\",\n                        style: _normalizeStyle(_ctx.getStyle(every)),\n                        src: every,\n                        alt: each.index.toString()\n                      }, null, 12, _hoisted_5))\n                    }), 128)),\n                    _withDirectives(_createElementVNode(\"hr\", null, null, 512), [\n                      [_directive_observe_visibility, {\n                callback: (isVisible, entry) => _ctx.observe(isVisible, entry, each)}\n              ]\n                    ])\n                  ]))\n                }), 128))\n              ]),\n              _createElementVNode(\"div\", null, [\n                _hoisted_6,\n                _hoisted_7,\n                _createVNode(_component_center, null, {\n                  default: _withCtx(() => [\n                    _createVNode(_component_loading, { size: 150 })\n                  ]),\n                  _: 1\n                })\n              ])\n            ])\n          ]))\n        : _createCommentVNode(\"\", true)\n    ])\n  ], 4))\n}","\nimport {\n  defineComponent, ref, reactive, inject, computed, ComputedRef, onMounted,\n} from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useGtag } from 'vue-gtag-next';\n\nimport { useStore } from '@/store';\n\nimport fetchAPI from '@/api/fetch';\nimport { Chapter } from '@/api/type';\n\nimport ReaderNav from '@/components/reader/CReaderNav.vue';\n\nexport default defineComponent({\n  components: { ReaderNav },\n  setup() {\n    const { pageview, event } = useGtag();\n    const route = useRoute();\n    const store = useStore();\n    const { fetchComicByID, fetchComicChapter } = fetchAPI();\n    const height = inject('height');\n    const session = inject<ComputedRef<string>>('session')!;\n    const comicID = ref('');\n    const lightOn = ref(false);\n    const loading = ref(false);\n    const sections = reactive<Array<Chapter>>([]);\n    const fetchIndex = ref(0);\n    const currentIndex = ref(1);\n    const transitIndex = ref(0);\n    const bookmark = computed(() => store.getters['user/getComicBookmarkByID'](comicID.value) || {});\n    const comic = computed(() => store.getters['book/getComicByID'](comicID.value) || {});\n\n    const fetchChapter = async (index: number): Promise<Chapter> => {\n      const data = await fetchComicChapter(session.value, comicID.value, index);\n      event('read', {\n        event_category: 'comic',\n        event_label: `${comicID.value}-${comic.value.title}`,\n        value: index,\n      });\n      return {\n        index,\n        content: data,\n      };\n    };\n    const get = async () => {\n      sections.splice(0);\n      fetchIndex.value = currentIndex.value - 1;\n      transitIndex.value = currentIndex.value - 1;\n\n      await fetchChapter(fetchIndex.value).then((data) => sections.push(data));\n      fetchIndex.value += 1;\n      await fetchChapter(fetchIndex.value).then((data) => sections.push(data));\n      fetchIndex.value += 1;\n    };\n    const mounted = async () => {\n      comicID.value = route.params.comicID as string;\n\n      if (!store.getters['book/isComicIDExists'](comicID.value)) {\n        await fetchComicByID(session.value, comicID.value)\n          .then((data) => store.commit('book/insertComic', { comicID: comicID.value, comic: data }));\n      } else {\n        const localComic = store.getters['book/getComicByID'](comicID.value);\n        if (localComic.chapters === undefined\n          || store.getters['book/isComicNeedUpdate'](comicID.value)) {\n          await fetchComicByID(session.value, comicID.value)\n            .then((data) => store.commit('book/updateComic', { comicID: comicID.value, comic: data }));\n        }\n        currentIndex.value = bookmark.value.lastReadIndex || currentIndex.value;\n      }\n      get();\n    };\n    const onChangeIndex = (setIndex: number) => {\n      currentIndex.value = setIndex;\n      get();\n    };\n    const getStyle = (url: string) => (url.endsWith('20%') ? { width: '20%' } : {});\n    const observe = (isVisible: boolean, entry: any, section: Chapter) => {\n      if (isVisible) {\n        if (transitIndex.value < section.index) {\n          currentIndex.value = section.index + 1;\n          transitIndex.value = section.index;\n          bookmark.value.lastReadIndex = currentIndex.value;\n          store.commit('user/insertComicBookmark', { comicID: comic.value.comicID, bookmark: bookmark.value });\n          if (!loading.value && fetchIndex.value - currentIndex.value < 1) {\n            loading.value = true;\n            fetchChapter(fetchIndex.value).then((data) => sections.push(data));\n            fetchIndex.value += 1;\n            setTimeout(() => {\n              loading.value = false;\n            }, 1000);\n          }\n        }\n      }\n    };\n\n    onMounted(() => {\n      mounted();\n      pageview({ page_title: comic.value.title });\n    });\n    /* eslint-disable object-property-newline */\n    return {\n      height, comicID, loading, lightOn,\n      sections, fetchIndex, currentIndex, transitIndex,\n      bookmark, comic,\n      onChangeIndex, getStyle, observe,\n    };\n    /* eslint-enable object-property-newline */\n  },\n});\n","import { render } from \"./VComic.vue?vue&type=template&id=1f0dd363&scoped=true&ts=true\"\nimport script from \"./VComic.vue?vue&type=script&lang=ts\"\nexport * from \"./VComic.vue?vue&type=script&lang=ts\"\n\nimport \"./VComic.vue?vue&type=style&index=0&id=1f0dd363&scoped=true&lang=css\"\n\nimport exportComponent from \"/home/runner/work/Silverfish-Vue/Silverfish-Vue/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-1f0dd363\"]])\n\nexport default __exports__"],"names":["_withScopeId","n","_pushScopeId","_popScopeId","_hoisted_1","id","class","_hoisted_2","key","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_createElementVNode","_hoisted_7","render","_ctx","_cache","$props","$setup","$data","$options","_component_reader_nav","_resolveComponent","_component_loading","_component_center","_directive_observe_visibility","_resolveDirective","_openBlock","_createElementBlock","style","_normalizeStyle","height","Object","keys","comic","length","_createVNode","type","comicID","currentIndex","onChangeIndex","chapterLength","chapters","_Fragment","_renderList","sections","each","index","content","every","referrerpolicy","getStyle","src","alt","toString","_withDirectives","callback","isVisible","entry","observe","default","_withCtx","size","_","_createCommentVNode","defineComponent","components","ReaderNav","setup","pageview","event","useGtag","route","useRoute","store","useStore","fetchComicByID","fetchComicChapter","fetchAPI","inject","session","ref","lightOn","loading","reactive","fetchIndex","transitIndex","bookmark","computed","getters","value","fetchChapter","async","data","event_category","event_label","title","get","splice","then","push","mounted","params","localComic","undefined","commit","lastReadIndex","setIndex","url","endsWith","width","section","setTimeout","onMounted","page_title","__exports__"],"sourceRoot":""}