"use strict";(self["webpackChunksilverfish"]=self["webpackChunksilverfish"]||[]).push([[493],{6170:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(3396),i=n(6265),r=n.n(i),l=n(4677);function o(){const e=(0,l.pm)(),t=(0,a.FN)()?.appContext.config.globalProperties.$endpoint,n=(0,a.FN)()?.appContext.config.globalProperties.$apiVersionRoute;function i(){return`${t}${n}`}function o(t){return new Promise(((n,a)=>r()({url:`${i()}/novels`,method:"GET",headers:{Authorization:t}}).then((e=>e.data.success?n(e.data.data.map((e=>({...e,lastCrawlTime:new Date(e.lastCrawlTime)})))):a(e.data.data))).catch((t=>e.error(`發生錯誤: ${t.toString()}`)))))}function c(t,n){return new Promise(((a,l)=>r()({url:`${i()}/novel`,method:"GET",headers:{Authorization:t},params:{novel_id:n}}).then((e=>{if(e.data.success){const t=e.data.data;return a({isEnable:t.isEnable,novelID:t.novelID,author:t.author,description:t.description,dns:t.dns,url:t.url,title:t.title,cover_url:t.coverUrl,chapters:t.chapters,lastCrawlTime:new Date(t.lastCrawlTime)})}return l(e.data.data)})).catch((t=>e.error(`發生錯誤: ${t.toString()}`)))))}function s(t,n,a){return new Promise(((l,o)=>r()({url:`${i()}/chapter`,method:"GET",headers:{Authorization:t},params:{novel_id:n,chapter_index:a}}).then((e=>e.data.success?l(e.data.data):o(e.data.data))).catch((t=>e.error(`發生錯誤: ${t.toString()}`)))))}function u(t){return new Promise(((n,a)=>r()({url:`${i()}/comics`,method:"GET",headers:{Authorization:t}}).then((e=>e.data.success?n(e.data.data.map((e=>({...e,lastCrawlTime:new Date(e.lastCrawlTime)})))):a(e.data.data))).catch((t=>e.error(`發生錯誤: ${t.toString()}`)))))}function d(t,n){return new Promise(((a,l)=>r()({url:`${i()}/comic`,method:"GET",headers:{Authorization:t},params:{comic_id:n}}).then((e=>{if(e.data.success){const t=e.data.data;return a({comicID:t.comicID,author:t.author,description:t.description,dns:t.dns,url:t.url,title:t.title,cover_url:t.coverUrl,chapters:t.chapters,lastCrawlTime:new Date(t.lastCrawlTime)})}return l(e.data.data)})).catch((t=>e.error(`發生錯誤: ${t.toString()}`)))))}function h(t,n,a){return new Promise(((l,o)=>r()({url:`${i()}/comic/chapter`,method:"GET",headers:{Authorization:t},params:{comic_id:n,chapter_index:a}}).then((e=>e.data.success?l(e.data.data):o(e.data.data))).catch((t=>e.error(`發生錯誤: ${t.toString()}`)))))}return{endpointRoute:i,fetchNovels:o,fetchNovelByID:c,fetchNovelChapter:s,fetchComics:u,fetchComicByID:d,fetchComicChapter:h}}},7885:function(e,t,n){n.d(t,{Z:function(){return k}});var a=n(3396),i=n(7139),r=n(9242);const l=e=>((0,a.dD)("data-v-1c5d49ef"),e=e(),(0,a.Cn)(),e),o={class:"reader-nav-buttons"},c=l((()=>(0,a._)("br",null,null,-1))),s=l((()=>(0,a._)("br",null,null,-1))),u={key:0},d=l((()=>(0,a._)("br",null,null,-1))),h=l((()=>(0,a._)("br",null,null,-1))),m=l((()=>(0,a._)("br",null,null,-1))),v=["disabled"],g=l((()=>(0,a._)("br",null,null,-1)));function b(e,t,n,l,b,p){const f=(0,a.up)("font-awesome-icon"),y=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("div",{id:"reader-nav",class:(0,i.C_)(["col-2 animated faster",{fadeIn:e.visible,fadeOut:!e.visible}]),onMouseenter:t[6]||(t[6]=(...t)=>e.enter&&e.enter(...t)),onFocusin:t[7]||(t[7]=(...t)=>e.enter&&e.enter(...t)),onMouseleave:t[8]||(t[8]=(...t)=>e.leave&&e.leave(...t)),onFocusout:t[9]||(t[9]=(...t)=>e.leave&&e.leave(...t))},[(0,a._)("div",o,[(0,a._)("button",{class:(0,i.C_)(["sticky-bar-el btn btn-circle btn-sm",{"btn-primary":e.lightOn,"btn-secondary":!e.lightOn}]),onClick:t[0]||(t[0]=t=>e.go(-1))},[(0,a.Wm)(f,{icon:"home"})],2),c,(0,a.Wm)(y,{to:{path:`/info/${e.type}/${e.id}`}},{default:(0,a.w5)((()=>[(0,a._)("button",{class:(0,i.C_)(["sticky-bar-el btn btn-circle btn-sm",{"btn-primary":e.lightOn,"btn-secondary":!e.lightOn}])},[(0,a.Wm)(f,{icon:"info"})],2)])),_:1},8,["to"]),s,"novel"==e.type?((0,a.wg)(),(0,a.iD)("div",u,[(0,a._)("button",{class:(0,i.C_)(["sticky-bar-el btn btn-circle btn-sm",{"btn-primary":e.lightOn,"btn-secondary":!e.lightOn}]),onClick:t[1]||(t[1]=t=>e.changeSimplified())},(0,i.zw)(e.isTW?"TW":"CH"),3),d,(0,a._)("button",{class:(0,i.C_)(["sticky-bar-el btn-circle btn btn-sm",{"btn-primary":e.lightOn,"btn-secondary":!e.lightOn}]),onClick:t[2]||(t[2]=t=>e.changeLight())},[e.lightOn?((0,a.wg)(),(0,a.j4)(f,{key:0,icon:["fa","lightbulb"]})):(0,a.kq)("",!0),e.lightOn?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(f,{key:1,icon:["far","lightbulb"]}))],2),h,(0,a._)("button",{class:(0,i.C_)(["sticky-bar-el btn btn-circle btn-sm",{"btn-primary":e.lightOn,"btn-secondary":!e.lightOn}]),onClick:t[3]||(t[3]=t=>e.changeFontSize())},(0,i.zw)(["Sm","Md","Lg","Xl"][e.fontSize-1]),3),m])):(0,a.kq)("",!0),(0,a._)("div",null,[(0,a.wy)((0,a._)("input",{class:(0,i.C_)(["sticky-bar-el chapter-text form-control form-control-sm",{"bg-white":e.lightOn,"text-dark":e.lightOn,"bg-dark":!e.lightOn,"text-white":!e.lightOn}]),maxlength:"5","onUpdate:modelValue":t[4]||(t[4]=t=>e.index=t)},null,2),[[r.nr,e.index]]),(0,a._)("button",{class:(0,i.C_)(["sticky-bar-el btn btn-circle btn-sm",{"btn-primary":e.lightOn,"btn-secondary":!e.lightOn}]),onClick:t[5]||(t[5]=t=>e.changeIndex()),disabled:0===e.chapterLength},[(0,a.Wm)(f,{icon:"arrow-right"})],10,v),g])])],34)}var p=n(4870),f=n(678),y=(0,a.aZ)({props:["type","id","isTW","lightOn","fontSize","currentIndex","chapterLength"],setup(e,{emit:t}){const n=(0,f.tv)(),i=(0,p.iH)(!1),r=(0,p.iH)(0);(0,a.bv)((()=>{r.value=e.currentIndex})),(0,a.YP)((()=>e.currentIndex),(e=>{r.value=e}));const{go:l}=n,o=()=>{i.value=!0},c=()=>{i.value=!1},s=()=>{t("changeSimplified",!e.isTW)},u=()=>{t("changeLight",!e.lightOn)},d=()=>{t("changeFontSize",4===e.fontSize?1:e.fontSize+1)},h=()=>{t("changeIndex",r.value)};return{visible:i,index:r,go:l,enter:o,leave:c,changeSimplified:s,changeLight:u,changeFontSize:d,changeIndex:h}}}),C=n(89);const w=(0,C.Z)(y,[["render",b],["__scopeId","data-v-1c5d49ef"]]);var k=w},114:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var a=n(3396),i=n(7139);const r=e=>((0,a.dD)("data-v-4a625de6"),e=e(),(0,a.Cn)(),e),l={id:"article",class:"container"},o={key:0,class:"row"},c={class:"col-12"},s={id:"comic"},u=["src","alt"],d=r((()=>(0,a._)("br",null,null,-1))),h=r((()=>(0,a._)("br",null,null,-1)));function m(e,t,n,r,m,v){const g=(0,a.up)("reader-nav"),b=(0,a.up)("loading"),p=(0,a.up)("center"),f=(0,a.Q2)("observe-visibility");return(0,a.wg)(),(0,a.iD)("div",{id:"content",style:(0,i.j5)({"min-height":`${e.height}px`})},[(0,a._)("div",l,[0!==Object.keys(e.comic).length?((0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(g,{type:"comic",id:e.comicID,currentIndex:e.currentIndex,onChangeIndex:e.onChangeIndex,chapterLength:e.comic.chapters.length},null,8,["id","currentIndex","onChangeIndex","chapterLength"]),(0,a._)("div",c,[(0,a._)("div",s,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.sections,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.index},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.content,(n=>((0,a.wg)(),(0,a.iD)("img",{key:n,referrerpolicy:"no-referrer",style:(0,i.j5)(e.getStyle(n)),src:n,alt:t.index.toString()},null,12,u)))),128)),(0,a.wy)((0,a._)("hr",null,null,512),[[f,{callback:(n,a)=>e.observe(n,a,t)}]])])))),128))]),(0,a._)("div",null,[d,h,(0,a.Wm)(p,null,{default:(0,a.w5)((()=>[(0,a.Wm)(b,{size:150})])),_:1})])])])):(0,a.kq)("",!0)])],4)}var v=n(4870),g=n(678),b=n(3196),p=n(6170),f=n(7885),y=(0,a.aZ)({components:{ReaderNav:f.Z},setup(){const e=(0,g.yj)(),t=(0,b.oR)(),{fetchComicByID:n,fetchComicChapter:i}=(0,p.Z)(),r=t.getters["auth/getSession"],l=(0,a.f3)("height"),o=(0,v.iH)(""),c=(0,v.iH)(!1),s=(0,v.iH)(!1),u=(0,v.qj)([]),d=(0,v.iH)(0),h=(0,v.iH)(1),m=(0,v.iH)(0),f=(0,a.Fl)((()=>t.getters["user/getComicBookmarkByID"](o.value)||{})),y=(0,a.Fl)((()=>t.getters["book/getComicByID"](o.value)||{})),C=async e=>{const t=await i(r,o.value,e);return{index:e,content:t}},w=async()=>{u.splice(0),d.value=h.value-1,m.value=h.value-1,await C(d.value).then((e=>u.push(e))),d.value+=1,await C(d.value).then((e=>u.push(e))),d.value+=1},k=async()=>{if(o.value=e.params.comicID,t.getters["book/isComicIDExists"](o.value)){const e=t.getters["book/getComicByID"](o.value);(void 0===e.chapters||t.getters["book/isComicNeedUpdate"](o.value))&&await n(r,o.value).then((e=>t.commit("book/updateComic",{comicID:o.value,comic:e}))),h.value=f.value.lastReadIndex||h.value}else await n(r,o.value).then((e=>t.commit("book/insertComic",{comicID:o.value,comic:e})));w()},_=e=>{h.value=e,w()},I=e=>e.endsWith("20%")?{width:"20%"}:{},x=(e,n,a)=>{e&&m.value<a.index&&(h.value=a.index+1,m.value=a.index,f.value.lastReadIndex=h.value,t.commit("user/insertComicBookmark",{comicID:y.value.comicID,bookmark:f.value}),!s.value&&d.value-h.value<1&&(s.value=!0,C(d.value).then((e=>u.push(e))),d.value+=1,setTimeout((()=>{s.value=!1}),1e3)))};return k(),{height:l,comicID:o,loading:s,lightOn:c,sections:u,fetchIndex:d,currentIndex:h,transitIndex:m,bookmark:f,comic:y,onChangeIndex:_,getStyle:I,observe:x}}}),C=n(89);const w=(0,C.Z)(y,[["render",m],["__scopeId","data-v-4a625de6"]]);var k=w}}]);
//# sourceMappingURL=comic.563a034f.js.map